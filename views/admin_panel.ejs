<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css" rel="stylesheet">
    <title>پنل ادمین</title>

    <style>
        @font-face {
            font-family: 'vazir';
            src: url('/css/Vazir-Bold.ttf');
        }

        body {
            font-family: 'vazir';
            color: #fff;
        }

        .sidebar {
            background-color: rgb(74, 170, 138);
            height: 100vh;
            padding: 20px;
            position: sticky;
            top: 0;
        }

        .sidebar ul {
            list-style: none;
            justify-content: center;
        }

        .sidebar li {
            text-align: center;
            font-size: large;
            padding: 5px;
            transition: 0.5s;
            margin-top: 20px;
        }

        .sidebar li:hover {
            border-radius: 20px;
            background-color: aquamarine;
            color: black;
            transition: 0.5s;
            cursor: pointer;
        }

        .error_back {
            background-color: red !important;
        }

        .success_back {
            background-color: rgb(33, 161, 16) !important;
        }

        .warn_back {
            background-color: rgb(175, 106, 15) !important;
        }

        .info_back {
            background-color: rgb(100, 100, 100) !important;
        }
    </style>
</head>

<body>


    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3 col-lg-2 sidebar">
                <ul>
                    <li> <i class="bi bi-speedometer"></i> داشبورد </li>
                    <li> <i class="bi bi-box"></i> پست ها </li>
                    <li> <i class="bi bi-list"></i> دسته بندی ها </li>
                    <li> <i class="bi bi-people"></i> کاربران </li>
                    <% if(permissions.includes('VIEW_LOGS') || permissions.includes('ADMINISTRATOR')){ %>
                        <li onclick="selectSec('log_template')"> <i class="bi bi-file-earmark-post"></i> لاگ ها </li>
                        <%}%>
                </ul>
            </div>
            <div class="col-md-9 col-lg-10" id="MainContent">
                <template id="log_template">
                    <div class="container py-5">
                        <h2 class="text-dark mb-4">لاگ‌ها</h2>

                        <!-- نوبار فیلتر و جستجو -->
                        <nav class="navbar bg-light rounded shadow-sm px-3 mb-4">
                            <div class="container-fluid flex-wrap justify-content-between">

                                <!-- فیلتر و رفرش -->
                                <div class="d-flex gap-4 align-items-center">
                                    <select class="form-select" onclick="filter_log(this.value)">
                                        <option value="all">همه</option>
                                        <option value="success">موفق</option>
                                        <option value="info">اطلاعات</option>
                                        <option value="warn">هشدار</option>
                                        <option value="error">خطا</option>
                                    </select>
                                    <button class="btn btn-outline-primary" id="log_refresh_btn" onclick=" get_logs()">
                                        <i class="bi bi-arrow-clockwise"></i> رفرش
                                    </button>
                                    <button class="btn btn-outline-primary">
                                        <a class="nav-link" href="http://localhost:3000/log/download/all">خروجی  JSON</a>
                                    </button>
                                </div>
                            </div>
                        </nav>


                        
                        <!-- ردیف نمایش لاگ‌ها -->
                        <div class="row" id="log_results_row">

                        </div>
                    </div>
                </template>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let logs = []

        function selectSec(sectionid) {
            const template = document.getElementById(sectionid);
            document.getElementById('MainContent').innerHTML = template.innerHTML;
            // switch (sectionid) {
            //     case "log_template":
            //         search_log()
            //         break;

            // }
        }

        async function get_logs() {
            logs = []
            const result = await fetch('http://localhost:3000/log/get', {
                method: "GET"
            })
            const log_results_row = document.getElementById('log_results_row')
            log_results_row.innerHTML = '' // پاک‌سازی لاگ‌های قبلی

            logs = await result.json()
            logs.forEach(log => {
                const div = document.createElement('div')
                div.classList.add('col-4', 'p-2', 'm-1', 'rounded-3', 'log_card', `${log.level}_back`);

                div.innerHTML = `
            <h6>موضوع : ${log.title} </h6>
            <p>متن : ${log.message} </p>
            <h6>ایپی : ${log.ip}</h6>
            <h6>تاریخ : ${log.time}</h6>
            <button onclick="delete_log(${log.id})"> <i class="bi bi-trash text-danger"></i> </button>
        `
                log_results_row.appendChild(div)
            });
        }

        function filter_log(type) {
            const allLogs = document.querySelectorAll('.log_card');
            allLogs.forEach(log => {
                if (type === 'all') {
                    log.style.display = 'block';
                } else {
                    if (log.classList.contains(`${type}_back`)) {
                        log.style.display = 'block';
                    } else {
                        log.style.display = 'none';
                    }
                }
            });
        }

            async function delete_log(id) {
                const result = await fetch(`http://localhost:3000/log/delete/${id}`, {
                    method: "POST"
                })

                const data = await result.json()
                alert(data)
            }

    </script>
</body>

</html>