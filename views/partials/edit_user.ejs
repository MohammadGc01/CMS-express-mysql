<%- include('./header') %>



<div class="container py-2">
    <h1>Edit User</h1>
    <label for="username">Name:</label>
    <input type="text" id="username" name="name" value="<%= user.username %>" class="form-control w-50" required>
    <br><br>
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" value="<%= user.email %>" class="form-control w-50" required>
    <br>
    <button type="submit" class="btn btn-outline-primary my-4" onclick="update_user()">Update User</button>

</div>

<div class="container py-2">
        <h1>Add Role</h1>
        <label for="user_id">شناسه کاربر:</label>
        <input type="text" id="user_id" value="<%= user.id %>" class="form-control w-50" required>
        <br><br>
        <label for="role_id">شناسه رول:</label>
        <input type="text" id="role_id" value="" class="form-control w-50" required>
        <br>
        <button type="submit" class="btn btn-outline-primary my-4" onclick="add_role()">Add Role</button>
</div>

<div class="container">
    <h3>ایدی نقش ها</h3>

    <% role.forEach(r => { %>

        <button class="btn btn-danger" onclick="RemoveRole(<%= r.id %>)"><%= r.role_id %></button>

        <% })%>
</div>

<script>

async function RemoveRole(id) {

    const response = await fetch(`/user/role/remove/id/${id}`, {
        method: "DELETE",
    })

    const result = await response.json()
    alert(result)
    
}

async function update_user() {
    const username = document.getElementById('username').value;
    const email = document.getElementById('email').value;

    const response = await fetch(`/user/update/<%= user.id %>`, {
       method : "PUT",
       headers : {
        "Content-Type" : "application/json"
       },
       body : JSON.stringify({
        username : username,
        email : email
       })
    })

    const result = await response.json()
    alert(result.message)

}

async function add_role() {
      const user_id = document.getElementById('user_id').value;
    const role_id = document.getElementById('role_id').value;

    const response = await fetch(`/user/role/add`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            user_id: user_id,
            role_id: role_id
        })
    })

    const result = await response.json()
    alert(result.message)
}

</script>