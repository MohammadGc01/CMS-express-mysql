<nav class="navbar navbar-expand-lg bg-body-tertiary shadow p-3">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <%= title %>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mx-auto mb-2 mb-lg-0" id="category_result">
      </ul>

      <ul class="nav nav-pills nav-fill d-md-none d-lg-flex">

      <li class="nav-item">
        <button class="btn btn-outline-warning rounded-5" aria-current="page" href="#">
          <i class="bi bi-search fs-6"></i>
        </button>
      </li>

        <li class="nav-item me-2">
          <% if (user) { %>
            <a class="btn btn-outline-warning rounded-5 d-flex" aria-current="page" href="/user/panel">
              <i class="bi bi-person fs-6"></i>
              <%= user.username %>
            </a>
            <% } else { %>
              <a class="btn btn-outline-warning rounded-5" aria-current="page" href="/user/auth">
                <i class="bi bi-person fs-4"></i>
              </a>
              <% } %>
        </li>
        
  



      </ul>
    </div>
  </div>
</nav>

<script type="module">
  async function loadCategories() {
    try {
      const result_cat = await fetch("/post/get/categorys");
      const data_cat = await result_cat.json();

      const result_sub_cat = await fetch("/post/get/sub/categorys");
      const data_sub_cat = await result_sub_cat.json();

      const category_result = document.getElementById('category_result');

      data_cat.forEach(category => {
        const li = document.createElement('li');
        li.classList.add('nav-item', 'dropdown');

        const a = document.createElement('a');
        a.classList.add('nav-link', 'dropdown-toggle');
        a.href = "#";
        a.setAttribute('role', 'button');
        a.setAttribute('data-bs-toggle', 'dropdown');
        a.textContent = category.name;

        const ul = document.createElement('ul');
        ul.classList.add('dropdown-menu');

        const subs = data_sub_cat.filter(sub => sub.category_id === category.id);

        subs.forEach(sub => {
          const subLi = document.createElement('li');
          const subA = document.createElement('a');
          subA.classList.add('dropdown-item');
          subA.href = `/post/sub_category/${sub.id}`;
          subA.textContent = sub.name;
          subLi.appendChild(subA);
          ul.appendChild(subLi);
        });

        li.appendChild(a);
        li.appendChild(ul);
        category_result.appendChild(li);
      });
    } catch (error) {
      console.error("Error loading categories:", error);
    }
  }

  loadCategories();
</script>